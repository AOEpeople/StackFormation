

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Blueprints &mdash; StackFormation dev-master documentation</title>
  

  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  

  

  
        <link rel="index" title="Index"
              href="../genindex.html"/>
        <link rel="search" title="Search" href="../search.html"/>
    <link rel="top" title="StackFormation dev-master documentation" href="../index.html"/>
        <link rel="next" title="Templates" href="../Templates/index.html"/>
        <link rel="prev" title="Getting Started" href="../GettingStarted/index.html"/> 

  
  <script src="../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../index.html" class="icon icon-home"> StackFormation
          

          
          </a>

          
            
            
              <div class="version">
                dev-master
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <p class="caption"><span class="caption-text">Getting started Documentation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../GettingStarted/index.html">Getting Started</a></li>
</ul>
<p class="caption"><span class="caption-text">StackFormation Documentation</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">Blueprints</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#structuring-your-blueprints">Structuring your blueprints</a></li>
<li class="toctree-l2"><a class="reference internal" href="#parameters">Parameters</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#adding-parameters">Adding parameters</a></li>
<li class="toctree-l3"><a class="reference internal" href="#parameter-values">Parameter values</a></li>
<li class="toctree-l3"><a class="reference internal" href="#conditional-parameter-values">Conditional parameter values</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#wildcards">Wildcards</a></li>
<li class="toctree-l2"><a class="reference internal" href="#effective-stackname">Effective stackname</a></li>
<li class="toctree-l2"><a class="reference internal" href="#reverse-blueprint-match">Reverse blueprint match</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../Templates/index.html">Templates</a></li>
<li class="toctree-l1"><a class="reference internal" href="../StackReferences/index.html">Stack references</a></li>
<li class="toctree-l1"><a class="reference internal" href="../UserData/index.html">User data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Stack/index.html">Stack</a></li>
<li class="toctree-l1"><a class="reference internal" href="../StackPolicies/index.html">Stack policies</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Functions/index.html">Functions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../FilePaths/index.html">File paths</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ShellCommands/index.html">Shell commands</a></li>
<li class="toctree-l1"><a class="reference internal" href="../AwsSdk/index.html">AWS Sdk</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Misc/index.html">Misc</a></li>
</ul>
<p class="caption"><span class="caption-text">User Documentation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../Contributing/index.html">Contributing</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../index.html">StackFormation</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          

 



<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html">Docs</a> &raquo;</li>
      
    <li>Blueprints</li>
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../_sources/Blueprints/index.txt" rel="nofollow"> View page source</a>
          
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="blueprints">
<h1>Blueprints<a class="headerlink" href="#blueprints" title="Permalink to this headline">¶</a></h1>
<img alt="../_images/overview.png" src="../_images/overview.png" />
<div class="section" id="structuring-your-blueprints">
<h2>Structuring your blueprints<a class="headerlink" href="#structuring-your-blueprints" title="Permalink to this headline">¶</a></h2>
<p>Structure your blueprints including all templates and other files (e.g. userdata) in &#8220;modules&#8221;. StackFormation will load all stack.yml files from following locations:</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">blueprints/*/*/*/blueprints.yml</span></code></li>
<li><code class="docutils literal"><span class="pre">blueprints/*/*/blueprints.yml</span></code></li>
<li><code class="docutils literal"><span class="pre">blueprints/*/blueprints.yml</span></code></li>
<li><code class="docutils literal"><span class="pre">blueprints/blueprints.yml</span></code></li>
<li><code class="docutils literal"><span class="pre">blueprints.yml</span></code></li>
</ul>
<p>So it&#8217;s suggested to create a directory structure like this one:</p>
<div class="highlight-yaml"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">blueprints/</span>
  <span class="l l-Scalar l-Scalar-Plain">stack1/</span>
    <span class="l l-Scalar l-Scalar-Plain">userdata/</span>
      <span class="l l-Scalar l-Scalar-Plain">provisioning.sh</span>
    <span class="l l-Scalar l-Scalar-Plain">blueprints.yml</span>
    <span class="l l-Scalar l-Scalar-Plain">my.template</span>
  <span class="l l-Scalar l-Scalar-Plain">stack2/</span>
    <span class="l l-Scalar l-Scalar-Plain">blueprints.yml</span>
  <span class="l l-Scalar l-Scalar-Plain">...</span>
</pre></div>
</div>
<p>All <code class="docutils literal"><span class="pre">blueprints.yml</span></code> files will be merged together.</p>
</div>
<div class="section" id="parameters">
<h2>Parameters<a class="headerlink" href="#parameters" title="Permalink to this headline">¶</a></h2>
<div class="section" id="adding-parameters">
<h3>Adding parameters<a class="headerlink" href="#adding-parameters" title="Permalink to this headline">¶</a></h3>
<p>Add parameters in your <code class="docutils literal"><span class="pre">my-stack.template</span></code>:</p>
<div class="highlight-json"><div class="highlight"><pre><span></span>{
  &quot;AWSTemplateFormatVersion&quot;: &quot;2010-09-09&quot;,
  &quot;Parameters: {
    &quot;MyParameter1&quot;: { &quot;Type&quot;: &quot;String&quot; }
  },
  &quot;Resources&quot;: {
    &quot;MyResource1&quot;: { &quot;Type&quot;: &quot;AWS::CloudFormation::WaitConditionHandle&quot; }
  }
}
</pre></div>
</div>
<p>... and configure that parameter in the <code class="docutils literal"><span class="pre">blueprint.yml</span></code> file:</p>
<div class="highlight-yaml"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">blueprints</span><span class="p p-Indicator">:</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">stackname</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">my-stack</span>
    <span class="l l-Scalar l-Scalar-Plain">template</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">my-stack.template</span>
    <span class="l l-Scalar l-Scalar-Plain">parameters</span><span class="p p-Indicator">:</span>
      <span class="l l-Scalar l-Scalar-Plain">MyParameter1</span><span class="p p-Indicator">:</span> <span class="s">&#39;Hello</span><span class="nv"> </span><span class="s">World&#39;</span>
</pre></div>
</div>
</div>
<div class="section" id="parameter-values">
<h3>Parameter values<a class="headerlink" href="#parameter-values" title="Permalink to this headline">¶</a></h3>
<table border="1" class="docutils">
<colgroup>
<col width="16%" />
<col width="23%" />
<col width="60%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Parameter</th>
<th class="head">Syntax</th>
<th class="head">Result</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>Output lookup</td>
<td><code class="docutils literal"><span class="pre">{output:&lt;stack&gt;:&lt;output&gt;}</span></code></td>
<td>Output value</td>
</tr>
<tr class="row-odd"><td>Resource lookup</td>
<td><code class="docutils literal"><span class="pre">{resource:&lt;stack&gt;:&lt;logicalResource&gt;}</span></code></td>
<td>Physical Id of that resource</td>
</tr>
<tr class="row-even"><td>Parameter lookup</td>
<td><code class="docutils literal"><span class="pre">{parameter:&lt;stack&gt;:&lt;logicalResource&gt;}</span></code></td>
<td>Parameter value (note that some parameters will not be shown if they&#8217;re &#8216;no_echo&#8217;)</td>
</tr>
<tr class="row-odd"><td>Env var lookup</td>
<td><code class="docutils literal"><span class="pre">{env:&lt;var&gt;}</span></code></td>
<td>Value of environment variable <code class="docutils literal"><span class="pre">var</span></code></td>
</tr>
<tr class="row-even"><td>Env var lookup with  fallback</td>
<td><code class="docutils literal"><span class="pre">{env:&lt;var&gt;:&lt;defaultValue&gt;}</span></code></td>
<td>Value of environment variable <code class="docutils literal"><span class="pre">var</span></code> falling back to <code class="docutils literal"><span class="pre">defaultValue</span></code> if env var is not set</td>
</tr>
<tr class="row-odd"><td>Stack/global variable lookup</td>
<td><code class="docutils literal"><span class="pre">{var:&lt;var&gt;}</span></code></td>
<td>Value variable <code class="docutils literal"><span class="pre">var</span></code></td>
</tr>
<tr class="row-even"><td>Current timestamp</td>
<td><code class="docutils literal"><span class="pre">{tstamp}</span></code></td>
<td>e.g. <code class="docutils literal"><span class="pre">1453151115</span></code></td>
</tr>
<tr class="row-odd"><td>MD5 sum</td>
<td><code class="docutils literal"><span class="pre">{md5:&lt;filename&gt;}</span></code></td>
<td>e.g. <code class="docutils literal"><span class="pre">fdd747e9989440289dcfb476c75b4268</span></code></td>
</tr>
<tr class="row-even"><td>Clean</td>
<td><code class="docutils literal"><span class="pre">{clean:2.1.7}</span></code></td>
<td><code class="docutils literal"><span class="pre">217</span></code> removes all characters that arent allowed in stack names</td>
</tr>
<tr class="row-odd"><td>Switch profile</td>
<td><code class="docutils literal"><span class="pre">[profile:&lt;profileName&gt;:...]</span></code></td>
<td>Will switch to a different profile and evaluate the second parameter there. This is useful in cross account setups</td>
</tr>
</tbody>
</table>
<p>Output and resource lookup allow you to &#8220;connect&#8221; stacks to each other by wiring the output or resources created in one stack to the input parameters needed in another stack that sits on top of the first one without manually managing the input values.</p>
<p>Example</p>
<div class="highlight-yaml"><div class="highlight"><pre><span></span>  <span class="l l-Scalar l-Scalar-Plain">blueprints</span><span class="p p-Indicator">:</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">stackname</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">stack1-db</span>
      <span class="l l-Scalar l-Scalar-Plain">template</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">templates/stack1.template</span>
      <span class="p p-Indicator">[</span><span class="nv">...</span><span class="p p-Indicator">]</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">stackname</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">stack2-app</span>
      <span class="l l-Scalar l-Scalar-Plain">template</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">templates/stack2.template</span>
      <span class="l l-Scalar l-Scalar-Plain">parameters</span><span class="p p-Indicator">:</span>
<span class="hll">        <span class="l l-Scalar l-Scalar-Plain">build</span><span class="p p-Indicator">:</span> <span class="s">&#39;s3://{output:stack1:bucketName}/{env:BUILD}/build.tar.gz&#39;</span>
</span><span class="hll">        <span class="l l-Scalar l-Scalar-Plain">db</span><span class="p p-Indicator">:</span> <span class="s">&#39;{output:stack1-db:DatabaseRds}&#39;</span>
</span></pre></div>
</div>
<p>Variables (global/local, nested into other placeholders)</p>
<div class="highlight-yaml"><div class="highlight"><pre><span></span>  <span class="l l-Scalar l-Scalar-Plain">vars</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">KeyPair</span><span class="p p-Indicator">:</span> <span class="s">&#39;mykeypair&#39;</span>

  <span class="l l-Scalar l-Scalar-Plain">blueprints</span><span class="p p-Indicator">:</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">stackname</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">mystack</span>
      <span class="l l-Scalar l-Scalar-Plain">vars</span><span class="p p-Indicator">:</span>
        <span class="l l-Scalar l-Scalar-Plain">ParentStack</span><span class="p p-Indicator">:</span> <span class="s">&#39;MyParentStack&#39;</span>
      <span class="l l-Scalar l-Scalar-Plain">parameters</span><span class="p p-Indicator">:</span>
<span class="hll">        <span class="l l-Scalar l-Scalar-Plain">KeyPair</span><span class="p p-Indicator">:</span> <span class="s">&#39;{var:mykeypair}&#39;</span>
</span><span class="hll">        <span class="l l-Scalar l-Scalar-Plain">Database</span><span class="p p-Indicator">:</span> <span class="s">&#39;{output:{var:ParentStack}:DatabaseRds}&#39;</span>
</span>      <span class="p p-Indicator">[</span><span class="nv">...</span><span class="p p-Indicator">]</span>
</pre></div>
</div>
<p>Switch Profile Example (in this example an AMI is baked in a different account and shared with this account)</p>
<div class="highlight-yaml"><div class="highlight"><pre><span></span>  <span class="l l-Scalar l-Scalar-Plain">blueprints</span><span class="p p-Indicator">:</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">stackname</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">mystack</span>
      <span class="l l-Scalar l-Scalar-Plain">parameters</span><span class="p p-Indicator">:</span>
<span class="hll">        <span class="l l-Scalar l-Scalar-Plain">BaseAmi</span><span class="p p-Indicator">:</span> <span class="s">&#39;[profile:myDevAccountProfile:{output:bakestack:BaseAmi}]&#39;</span>
</span></pre></div>
</div>
</div>
<div class="section" id="conditional-parameter-values">
<h3>Conditional parameter values<a class="headerlink" href="#conditional-parameter-values" title="Permalink to this headline">¶</a></h3>
<p>You might end up deploying the same stacks to multiple environments or accounts. Instead of duplicating the blueprints (or using YAML reference) you&#8217;ll probably want to parameterize your blueprints like this</p>
<div class="highlight-yaml"><div class="highlight"><pre><span></span>  <span class="l l-Scalar l-Scalar-Plain">blueprints</span><span class="p p-Indicator">:</span>
<span class="hll">    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">stackname</span><span class="p p-Indicator">:</span> <span class="s">&#39;app-{env:Environment}-build&#39;</span>
</span>      <span class="l l-Scalar l-Scalar-Plain">template</span><span class="p p-Indicator">:</span> <span class="s">&#39;build.template&#39;</span>
      <span class="l l-Scalar l-Scalar-Plain">parameters</span><span class="p p-Indicator">:</span>
        <span class="l l-Scalar l-Scalar-Plain">KeyPair</span><span class="p p-Indicator">:</span> <span class="s">&#39;MyKeyPair&#39;</span>
      <span class="p p-Indicator">[</span><span class="nv">...</span><span class="p p-Indicator">]</span>
</pre></div>
</div>
<p>... and then before deploying (locally or from your CI server) you&#8217;d set the env var first and then deploy:</p>
<div class="highlight-shell"><div class="highlight"><pre><span></span>$ <span class="nb">export</span> <span class="nv">Environment</span><span class="o">=</span>prod
$ vendor/bin/stackformation.php blueprint:deploy <span class="s1">&#39;app-{env:Environment}-build&#39;</span>
</pre></div>
</div>
<p>But in many cases those stacks do have some minor differences in some of the parameters (e.g. different VPCs or KeyNames,...) You could solve it like this with nested placeholders:</p>
<div class="highlight-yaml"><div class="highlight"><pre><span></span>  <span class="l l-Scalar l-Scalar-Plain">blueprints</span><span class="p p-Indicator">:</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">stackname</span><span class="p p-Indicator">:</span> <span class="s">&#39;app-{env:Environment}-build&#39;</span>
      <span class="l l-Scalar l-Scalar-Plain">template</span><span class="p p-Indicator">:</span> <span class="s">&#39;build.template&#39;</span>
      <span class="l l-Scalar l-Scalar-Plain">vars</span><span class="p p-Indicator">:</span>
<span class="hll">        <span class="l l-Scalar l-Scalar-Plain">prod-KeyName</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">MyProdKey</span>
</span><span class="hll">        <span class="l l-Scalar l-Scalar-Plain">stage-KeyName</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">MyStageKey</span>
</span>      <span class="l l-Scalar l-Scalar-Plain">parameters</span><span class="p p-Indicator">:</span>
<span class="hll">        <span class="l l-Scalar l-Scalar-Plain">KeyPair</span><span class="p p-Indicator">:</span> <span class="s">&#39;{var:{env:Environment}-KeyName}&#39;</span>
</span></pre></div>
</div>
<p>While this is perfectly possible this gets very confusing soon. Plus you&#8217;ll have to mention every variation of the variable explicitely.</p>
<p>Instead you can use a conditional value:</p>
<div class="highlight-yaml"><div class="highlight"><pre><span></span>  <span class="l l-Scalar l-Scalar-Plain">blueprints</span><span class="p p-Indicator">:</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">stackname</span><span class="p p-Indicator">:</span> <span class="s">&#39;app-{env:Environment}-build&#39;</span>
      <span class="l l-Scalar l-Scalar-Plain">template</span><span class="p p-Indicator">:</span> <span class="s">&#39;build.template&#39;</span>
      <span class="l l-Scalar l-Scalar-Plain">parameters</span><span class="p p-Indicator">:</span>
        <span class="l l-Scalar l-Scalar-Plain">KeyPair</span><span class="p p-Indicator">:</span>
<span class="hll">          <span class="s">&#39;{env:Environment}==prod&#39;</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">MyProdKey</span>
</span><span class="hll">          <span class="s">&#39;{env:Environment}==stage&#39;</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">MyStageKey</span>
</span><span class="hll">          <span class="s">&#39;{env:Environment}~=/^dev[0-9]+$/&#39;</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">MyDevKey</span>
</span><span class="hll">          <span class="s">&#39;default&#39;</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">MyDevKey</span>
</span></pre></div>
</div>
<p>StackFormation will evaluate all keys from top to bottom and the first key that evaluates to true will be returned. Allowed conditions: - <code class="docutils literal"><span class="pre">A==B</span></code> - <code class="docutils literal"><span class="pre">A!=B</span></code> - <code class="docutils literal"><span class="pre">A~=/^regex$/</span></code> - &#8216;default&#8217; (will always evaluate to true. Make sure you put this at the very end since everything after this will be ignored). Placeholders will be resolved before the conditions are evaluated.</p>
</div>
</div>
<div class="section" id="wildcards">
<h2>Wildcards<a class="headerlink" href="#wildcards" title="Permalink to this headline">¶</a></h2>
<p>When referencing a stack in <code class="docutils literal"><span class="pre">{output:&lt;stack&gt;:&lt;output&gt;}</span></code>, <code class="docutils literal"><span class="pre">{resource:&lt;stack&gt;:&lt;logicalResource&gt;}</span></code>, or <code class="docutils literal"><span class="pre">{parameter:&lt;stack&gt;:&lt;logicalResource&gt;}</span></code> you can use a wildcard to specify a stack. In this case StackFormation looks up all live stacks and finds a stack matching the pattern. If there&#8217;s no stack or more than a single stack matching the pattern StackFormation will throw an exception. This feature is helpful when you know there&#8217;s always only a single stack of one type that has a placeholder in it&#8217;s stackname:</p>
<p>Example: Stackname: <code class="docutils literal"><span class="pre">deployment-{env:BUILD_NUMBER}</span></code> In blueprints.yml:</p>
<div class="highlight-yaml"><div class="highlight"><pre><span></span>  <span class="l l-Scalar l-Scalar-Plain">blueprints</span><span class="p p-Indicator">:</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">stackname</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">mystack</span>
      <span class="l l-Scalar l-Scalar-Plain">parameters</span><span class="p p-Indicator">:</span>
<span class="hll">        <span class="l l-Scalar l-Scalar-Plain">Elb</span><span class="p p-Indicator">:</span> <span class="s">&#39;{output:deployment-*:Elb}&#39;</span>
</span></pre></div>
</div>
</div>
<div class="section" id="effective-stackname">
<h2>Effective stackname<a class="headerlink" href="#effective-stackname" title="Permalink to this headline">¶</a></h2>
<p>You can include environment variable in your stackname (which is very handy for automation via Jenkins). In this case your effective stackname (e.g. <code class="docutils literal"><span class="pre">build-5</span></code>) will be different from the configured stackname (e.g. <code class="docutils literal"><span class="pre">build-{env:BUILD_NUMBER}</span></code>)</p>
<p>Example</p>
<div class="highlight-yaml"><div class="highlight"><pre><span></span>  <span class="l l-Scalar l-Scalar-Plain">blueprints</span><span class="p p-Indicator">:</span>
<span class="hll">    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">stackname</span><span class="p p-Indicator">:</span> <span class="s">&#39;build-{env:BUILD_NUMBER}&#39;</span>
</span>      <span class="l l-Scalar l-Scalar-Plain">template</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">templates/deploy_build.template</span>
</pre></div>
</div>
</div>
<div class="section" id="reverse-blueprint-match">
<h2>Reverse blueprint match<a class="headerlink" href="#reverse-blueprint-match" title="Permalink to this headline">¶</a></h2>
<p>Let&#8217;s say you have a blueprint <code class="docutils literal"><span class="pre">ecom-{env:ACCOUNT}-{env:ENVIRONMENT}-static-stack</span></code> and you want to deploy it with ACCOUNT=t and ENVIRONMENT=dpl. You would do this by setting the env vars ACCOUNT and ENVIRONMENT and then run the deploy command:</p>
<div class="highlight-shell"><div class="highlight"><pre><span></span>$ <span class="nb">export</span> <span class="nv">ACCOUNT</span><span class="o">=</span>t
$ <span class="nb">export</span> <span class="nv">ENVIRONMENT</span><span class="o">=</span>dpl
$ vendor/bin/stackformation.php deploy <span class="s1">&#39;ecom-{env:ACCOUNT}-{env:ENVIRONMENT}-static-stack&#39;</span>
</pre></div>
</div>
<p>But instead you can also simply run the deploy command with the resulting stack name <code class="docutils literal"><span class="pre">ecom-t-tst-static-stack</span></code> StackFormation will then attempt to find a matching tag, determine which environments need to be set and run the original blueprint for you:</p>
<div class="highlight-shell"><div class="highlight"><pre><span></span>$ vendor/bin/stackformation.php deploy <span class="s1">&#39;ecom-t-tst-static-stack&#39;</span>

Blueprint reverse match found: ecom-<span class="o">{</span>env:ACCOUNT<span class="o">}</span>-<span class="o">{</span>env:ENVIRONMENT<span class="o">}</span>-static-stack
With ENV vars: <span class="nv">ACCOUNT</span><span class="o">=</span>t<span class="p">;</span> <span class="nv">ENVIRONMENT</span><span class="o">=</span>tst
Use this blueprint and <span class="nb">set</span> env vars? <span class="o">[</span>y/N<span class="o">]</span> y
Setting env var: <span class="nv">ACCOUNT</span><span class="o">=</span>t
Setting env var: <span class="nv">ENVIRONMENT</span><span class="o">=</span>tst
...
</pre></div>
</div>
</div>
</div>


           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../Templates/index.html" class="btn btn-neutral float-right" title="Templates" accesskey="n">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="../GettingStarted/index.html" class="btn btn-neutral" title="Getting Started" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2016, AOE GmbH.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'dev-master',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="../_static/jquery.js"></script>
      <script type="text/javascript" src="../_static/underscore.js"></script>
      <script type="text/javascript" src="../_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>